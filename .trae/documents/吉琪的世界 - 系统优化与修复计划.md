# 吉琪的世界 (JiQi's World) - 系统优化方案

针对您提出的五大维度的优化需求，经过深度代码审查，我发现了核心的**坐标系计算错误**是导致"照片显示未归位"和"选中位置偏移"的根本原因。以下是详细的优化与修复计划：

## 1. 核心修复：3D 交互与坐标系 (Functional Fixes)
### 问题分析
当前照片选中时移动到局部坐标 `(0,0,12)`。由于父容器（星球/螺旋）本身带有旋转角度，局部坐标的"正前方"并不等于屏幕的"正前方"。这导致选中照片会飞向屏幕侧面，且退出时路径混乱。

### 实施方案
*   **重构 `Photo` 组件动画逻辑**：
    *   **选中状态**：不再飞向固定的局部坐标。改为每一帧动态计算：将**世界坐标 (0,0,12)**（即镜头正前方）转换为当前父容器的**局部坐标**。
    *   **旋转锁定**：选中时强制照片 `lookAt` 摄像机，确保照片永远正对用户，而不是歪斜的。
    *   **归位逻辑**：退出选中时，平滑插值回原始布局坐标 `targetPosition`。
*   **优化智能选择算法**：
    *   废弃旧的启发式评分算法。
    *   改为计算**世界空间距离**：直接寻找距离摄像机最近的那张照片，确保"所见即所得"。

## 2. 代码质量与结构优化 (Code Quality)
*   **组件拆分**：虽然当前文件不大，但为了可维护性，建议将 `DesktopView` 中的 `Photo` 和 `SceneContent` 逻辑梳理清晰，增强代码可读性。
*   **常量管理**：将动画速度、布局半径等硬编码数值提取为常量配置，方便统一调整。

## 3. 性能优化 (Performance)
*   **按需渲染**：
    *   非选中状态下，照片只需 `lookAt(0,0,0)`（看向中心）。
    *   选中状态下，照片需 `lookAt(camera)`。
    *   减少不必要的每帧矩阵计算。
*   **资源加载**：
    *   确认图片使用了懒加载机制（React Three Drei 的 `Image` 组件已内置部分优化）。

## 4. 系统稳定性 (Stability)
*   **边界检查**：在手势识别和数据处理中增加判空保护（如 `groupRef.current` 为空时的保护）。
*   **状态同步**：确保 `selectedId` 置空时，`rotationSpeed` 能正确重置。

## 5. 用户体验 (UX)
*   **平滑过渡**：调整 Lerp 插值系数，使飞入飞出动画更具"磁性"和物理感。
*   **视觉反馈**：确保手势触发时音效与动画完全同步。

---

**待确认**：
如果您同意上述计划，我将立即开始执行代码修改，重点解决照片选中位置偏移和归位异常的问题。
